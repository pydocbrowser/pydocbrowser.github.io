<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  

  <head>
    
    <title>sqlalchemy.dialects.mssql.pyodbc</title>
    <meta name="generator" content="pydoctor 22.9.1.dev0"> 
        
    </meta>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
    <link rel="stylesheet" type="text/css" href="extra.css" />
</head>

  <body>

    <div id="banner">    
    <div>
        <a href="/">Home</a>
        &gt; sqlalchemy-2.0.3 <!-- This is a placeholder -->
        
        <!-- (<a href=""&gt;show all versions</a&gt;) -->
    </div>
</div>

    <nav class="navbar navbar-default mainnavbar">
      
  
  <div class="container-fluid">


    <div class="navbar-header">
      
      <div class="navlinks">
        <span class="navbar-brand">
          sqlalchemy <a href="index.html">API Documentation</a>
        </span>

        <a href="moduleIndex.html">
          Modules
        </a>

        <a href="classIndex.html">
          Classes
        </a>

        <a href="nameIndex.html">
          Names
        </a>

        <div id="search-box-container">
          <div class="input-group">
            <input id="search-box" type="search" name="search-query" placeholder="Search..." aria-label="Search" minlength="2" class="form-control" autocomplete="off" />
            
            <span class="input-group-btn">
              <a style="display: none;" class="btn btn-default" id="search-clear-button" title="Clear" onclick="clearSearch()"><img src="fonts/x-circle.svg" alt="Clear" /></a>
              <a class="btn btn-default" id="search-help-button" title="Help" onclick="toggleSearchHelpText()"><img src="fonts/info.svg" alt="Help" /></a>
            </span>
          </div>
        </div>

      </div>

      <div id="search-results-container" style="display: none;">
        
        <div id="search-buttons">
          <span class="label label-default" id="search-docstrings-button">
          <label class="checkbox-inline">
            <input type="checkbox" id="toggle-search-in-docstrings-checkbox" value="false" onclick="toggleSearchInDocstrings()">
              search in docstrings
            </input>
          </label>
          </span>
          
        </div>
        
        <noscript>
            <h1>Cannot search: JavaScript is not supported/enabled in your browser.</h1>
        </noscript>

        <div class="hint" id="search-help-box">
          <p class="rst-last">
      
            Search bar offers the following options:
            <ul>   
                <li>
                  <strong>Term presence.</strong> The below example searches for documents that 
                    must contain “foo”, might contain “bar” and must not contain “baz”: <code>+foo bar -baz</code>
                </li> 

                <li>
                  <strong>Wildcards.</strong> The below example searches for documents with words beginning with “foo”: <code>foo*</code>
                </li> 

                <li>
                  <strong>Search in specific fields.</strong> The following search matches all objects 
                  in "twisted.mail" that matches “search”: <code>+qname:twisted.mail.* +search</code>

                  <p>
                    Possible fields: 'name', 'qname' (fully qualified name), 'docstring', and 'kind'.
                    Last two fields are only applicable if "search in docstrings" is enabled.
                  </p>
                </li>

                <li>
                  <strong>Fuzzy matches.</strong> The following search matches all documents 
                  that have a word within 1 edit distance of “foo”: <code>foo~1</code>
                </li>
            </ul>

          </p>
        </div>

        <div id="search-status"> </div>

        <div class="warning" id="search-warn-box" style="display: none;">
          <p class="rst-last"><span id="search-warn"></span></p>
        </div>

        <table id="search-results">
          <!-- Filled dynamically by JS -->
        </table>
        
        <div style="margin-top: 8px;">
          <p>Results provided by <a href="https://lunrjs.com">Lunr.js</a></p>
        </div>
      </div>

    </div>


  </div>
</nav>
    
    <div class="container-fluid">

      <!-- Side navigation -->
      <div class="sidebarcontainer" style="display: none;">
        
        <div class="sidebar"><nav class="sidebar">
  

  <div>

      <div class="thingTitle">
        <span>Module</span>
        <code class="thisobject"><a href="sqlalchemy.dialects.mssql.pyodbc.html" class="internal-link" title="This module">pyodbc</a></code> 
      </div>
      
      <div>
        

        
         

        <div class="childrenKindTitle">Classes</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc.MSDialect_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc.MSDialect_pyodbc"><wbr></wbr>MSDialect_pyodbc</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc.MSExecutionContext_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc.MSExecutionContext_pyodbc"><wbr></wbr>MSExecution<wbr></wbr>Context_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._BINARY_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._BINARY_pyodbc">_<wbr></wbr>BINARY_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._JSON_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._JSON_pyodbc">_<wbr></wbr>JSON_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._JSONIndexType_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._JSONIndexType_pyodbc">_<wbr></wbr>JSONIndex<wbr></wbr>Type_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._JSONPathType_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._JSONPathType_pyodbc">_<wbr></wbr>JSONPath<wbr></wbr>Type_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._ms_binary_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ms_binary_pyodbc">_ms<wbr></wbr>_binary<wbr></wbr>_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._ms_numeric_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ms_numeric_pyodbc">_ms<wbr></wbr>_numeric<wbr></wbr>_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._MSFloat_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._MSFloat_pyodbc">_<wbr></wbr>MSFloat_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._MSNumeric_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._MSNumeric_pyodbc">_<wbr></wbr>MSNumeric_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTime.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTime">_<wbr></wbr>ODBCDate<wbr></wbr>Time</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTimeBindProcessor.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTimeBindProcessor">_<wbr></wbr>ODBCDate<wbr></wbr>Time<wbr></wbr>Bind<wbr></wbr>Processor</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._ODBCDATETIMEOFFSET.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ODBCDATETIMEOFFSET">_ODBCDATETIMEOFFSET</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._String_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._String_pyodbc">_<wbr></wbr>String_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._Unicode_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._Unicode_pyodbc">_<wbr></wbr>Unicode_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._UnicodeText_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._UnicodeText_pyodbc">_<wbr></wbr>Unicode<wbr></wbr>Text_pyodbc</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc._VARBINARY_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._VARBINARY_pyodbc">_<wbr></wbr>VARBINARY_pyodbc</a></code>
            </div>
        

    </li>
</ul>

        
         

        
         

        
         

        
         
        
      </div>
  </div><div>

      <div class="thingTitle">
        <span>Package</span>
        <code><a href="sqlalchemy.dialects.mssql.html" class="internal-link" title="The parent of this module">mssql</a></code> 
      </div>
      
      <div>
        

        <div class="childrenKindTitle">Modules</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.base.html" class="internal-link" title="sqlalchemy.dialects.mssql.base">base</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.information_schema.html" class="internal-link" title="sqlalchemy.dialects.mssql.information_schema">information<wbr></wbr>_schema</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.json.html" class="internal-link" title="sqlalchemy.dialects.mssql.json">json</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.provision.html" class="internal-link" title="sqlalchemy.dialects.mssql.provision">provision</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pymssql.html" class="internal-link" title="sqlalchemy.dialects.mssql.pymssql">pymssql</a></code>
            </div>
        

    </li><li class=" thisobject">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc">pyodbc</a></code>
            </div>
        

    </li>
</ul> 

        <div class="childrenKindTitle">Classes</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.BIT.html" class="internal-link" title="sqlalchemy.dialects.mssql.BIT">BIT</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.DATETIME2.html" class="internal-link" title="sqlalchemy.dialects.mssql.DATETIME2">DATETIME2</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.DATETIMEOFFSET.html" class="internal-link" title="sqlalchemy.dialects.mssql.DATETIMEOFFSET">DATETIMEOFFSET</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.IMAGE.html" class="internal-link" title="sqlalchemy.dialects.mssql.IMAGE">IMAGE</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.JSON.html" class="internal-link" title="sqlalchemy.dialects.mssql.JSON">JSON</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.MONEY.html" class="internal-link" title="sqlalchemy.dialects.mssql.MONEY">MONEY</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.NTEXT.html" class="internal-link" title="sqlalchemy.dialects.mssql.NTEXT">NTEXT</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.REAL.html" class="internal-link" title="sqlalchemy.dialects.mssql.REAL">REAL</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.ROWVERSION.html" class="internal-link" title="sqlalchemy.dialects.mssql.ROWVERSION">ROWVERSION</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.SMALLDATETIME.html" class="internal-link" title="sqlalchemy.dialects.mssql.SMALLDATETIME">SMALLDATETIME</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.SMALLMONEY.html" class="internal-link" title="sqlalchemy.dialects.mssql.SMALLMONEY">SMALLMONEY</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.SQL_VARIANT.html" class="internal-link" title="sqlalchemy.dialects.mssql.SQL_VARIANT">SQL<wbr></wbr>_VARIANT</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.TIME.html" class="internal-link" title="sqlalchemy.dialects.mssql.TIME">TIME</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.TIMESTAMP.html" class="internal-link" title="sqlalchemy.dialects.mssql.TIMESTAMP">TIMESTAMP</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.TINYINT.html" class="internal-link" title="sqlalchemy.dialects.mssql.TINYINT">TINYINT</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER.html" class="internal-link" title="sqlalchemy.dialects.mssql.UNIQUEIDENTIFIER">UNIQUEIDENTIFIER</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.VARBINARY.html" class="internal-link" title="sqlalchemy.dialects.mssql.VARBINARY">VARBINARY</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.XML.html" class="internal-link" title="sqlalchemy.dialects.mssql.XML">XML</a></code>
            </div>
        

    </li>
</ul>

        <div class="childrenKindTitle">Functions</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.dialects.mssql.html#try_cast" class="internal-link" title="sqlalchemy.dialects.mssql.try_cast">try<wbr></wbr>_cast</a></code>
            </div>
        

    </li>
</ul> 

        
         

        
         

        
         
        
      </div>
  </div>

</nav>
        </div>
        <div id="collapseSideBar">
          <a class="btn btn-link" onclick="toggleSideBarCollapse()" title="Toggle Sidebar Collapse">
          </a>
        </div> 
        <script src="sidebartoggle.js" type="text/javascript"></script>
       
      </div>

      <div id="main" class="">
        

        

        <div class="page-header">
          <h1 class="module"><code><code><a href="index.html" class="internal-link">sqlalchemy</a></code><wbr></wbr>.<code><a href="sqlalchemy.dialects.html" class="internal-link" title="sqlalchemy.dialects">dialects</a></code><wbr></wbr>.<code><a href="sqlalchemy.dialects.mssql.html" class="internal-link" title="sqlalchemy.dialects.mssql">mssql</a></code><wbr></wbr>.<code><a href="sqlalchemy.dialects.mssql.pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc">pyodbc</a></code></code></h1>
          <div id="showPrivate">
            <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
          </div>
        </div>

        <div class="categoryHeader">
          module documentation
        </div>

        <div class="extrasDocstring">
          <a href="https://github.com/pydocbrowser/pydocbrowser.github.io/tree/main/build/sources/sqlalchemy-2.0.3//lib/sqlalchemy/dialects/mssql/pyodbc.py" class="sourceLink">(source)</a>
          <p></p>
        </div>

        <div class="moduleDocstring">
          <div><p class="pre">.. dialect:: mssql+pyodbc
    :name: PyODBC
    :dbapi: pyodbc
    :connectstring: mssql+pyodbc://&lt;username&gt;:&lt;password&gt;@&lt;dsnname&gt;
    :url: https://pypi.org/project/pyodbc/

Connecting to PyODBC
--------------------

The URL here is to be translated to PyODBC connection strings, as
detailed in `ConnectionStrings &lt;https://code.google.com/p/pyodbc/wiki/ConnectionStrings&gt;`_.

DSN Connections
^^^^^^^^^^^^^^^

A DSN connection in ODBC means that a pre-existing ODBC datasource is
configured on the client machine.   The application then specifies the name
of this datasource, which encompasses details such as the specific ODBC driver
in use as well as the network address of the database.   Assuming a datasource
is configured on the client, a basic DSN-based connection looks like::

    engine = create_engine("mssql+pyodbc://scott:tiger@some_dsn")

Which above, will pass the following connection string to PyODBC::

    DSN=some_dsn;UID=scott;PWD=tiger

If the username and password are omitted, the DSN form will also add
the ``Trusted_Connection=yes`` directive to the ODBC string.

Hostname Connections
^^^^^^^^^^^^^^^^^^^^

Hostname-based connections are also supported by pyodbc.  These are often
easier to use than a DSN and have the additional advantage that the specific
database name to connect towards may be specified locally in the URL, rather
than it being fixed as part of a datasource configuration.

When using a hostname connection, the driver name must also be specified in the
query parameters of the URL.  As these names usually have spaces in them, the
name must be URL encoded which means using plus signs for spaces::

    engine = create_engine("mssql+pyodbc://scott:tiger@myhost:port/databasename?driver=ODBC+Driver+17+for+SQL+Server")

The ``driver`` keyword is significant to the pyodbc dialect and must be
specified in lowercase.

Any other names passed in the query string are passed through in the pyodbc
connect string, such as ``authentication``, ``TrustServerCertificate``, etc.
Multiple keyword arguments must be separated by an ampersand (``&amp;``); these
will be translated to semicolons when the pyodbc connect string is generated
internally::

    e = create_engine(
        "mssql+pyodbc://scott:tiger@mssql2017:1433/test?"
        "driver=ODBC+Driver+18+for+SQL+Server&amp;TrustServerCertificate=yes"
        "&amp;authentication=ActiveDirectoryIntegrated"
    )

The equivalent URL can be constructed using :class:`_sa.engine.URL`::

    from sqlalchemy.engine import URL
    connection_url = URL.create(
        "mssql+pyodbc",
        username="scott",
        password="tiger",
        host="mssql2017",
        port=1433,
        database="test",
        query={
            "driver": "ODBC Driver 18 for SQL Server",
            "TrustServerCertificate": "yes",
            "authentication": "ActiveDirectoryIntegrated",
        },
    )


Pass through exact Pyodbc string
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A PyODBC connection string can also be sent in pyodbc's format directly, as
specified in `the PyODBC documentation
&lt;https://github.com/mkleehammer/pyodbc/wiki/Connecting-to-databases&gt;`_,
using the parameter ``odbc_connect``.  A :class:`_sa.engine.URL` object
can help make this easier::

    from sqlalchemy.engine import URL
    connection_string = "DRIVER={SQL Server Native Client 10.0};SERVER=dagger;DATABASE=test;UID=user;PWD=password"
    connection_url = URL.create("mssql+pyodbc", query={"odbc_connect": connection_string})

    engine = create_engine(connection_url)

.. _mssql_pyodbc_access_tokens:

Connecting to databases with access tokens
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Some database servers are set up to only accept access tokens for login. For
example, SQL Server allows the use of Azure Active Directory tokens to connect
to databases. This requires creating a credential object using the
``azure-identity`` library. More information about the authentication step can be
found in `Microsoft's documentation
&lt;https://docs.microsoft.com/en-us/azure/developer/python/azure-sdk-authenticate?tabs=bash&gt;`_.

After getting an engine, the credentials need to be sent to ``pyodbc.connect``
each time a connection is requested. One way to do this is to set up an event
listener on the engine that adds the credential token to the dialect's connect
call. This is discussed more generally in :ref:`engines_dynamic_tokens`. For
SQL Server in particular, this is passed as an ODBC connection attribute with
a data structure `described by Microsoft
&lt;https://docs.microsoft.com/en-us/sql/connect/odbc/using-azure-active-directory#authenticating-with-an-access-token&gt;`_.

The following code snippet will create an engine that connects to an Azure SQL
database using Azure credentials::

    import struct
    from sqlalchemy import create_engine, event
    from sqlalchemy.engine.url import URL
    from azure import identity

    SQL_COPT_SS_ACCESS_TOKEN = 1256  # Connection option for access tokens, as defined in msodbcsql.h
    TOKEN_URL = "https://database.windows.net/"  # The token URL for any Azure SQL database

    connection_string = "mssql+pyodbc://@my-server.database.windows.net/myDb?driver=ODBC+Driver+17+for+SQL+Server"

    engine = create_engine(connection_string)

    azure_credentials = identity.DefaultAzureCredential()

    @event.listens_for(engine, "do_connect")
    def provide_token(dialect, conn_rec, cargs, cparams):
        # remove the "Trusted_Connection" parameter that SQLAlchemy adds
        cargs[0] = cargs[0].replace(";Trusted_Connection=Yes", "")

        # create token credential
        raw_token = azure_credentials.get_token(TOKEN_URL).token.encode("utf-16-le")
        token_struct = struct.pack(f"&lt;I{len(raw_token)}s", len(raw_token), raw_token)

        # apply it to keyword arguments
        cparams["attrs_before"] = {SQL_COPT_SS_ACCESS_TOKEN: token_struct}

.. tip::

    The ``Trusted_Connection`` token is currently added by the SQLAlchemy
    pyodbc dialect when no username or password is present.  This needs
    to be removed per Microsoft's
    `documentation for Azure access tokens
    &lt;https://docs.microsoft.com/en-us/sql/connect/odbc/using-azure-active-directory#authenticating-with-an-access-token&gt;`_,
    stating that a connection string when using an access token must not contain
    ``UID``, ``PWD``, ``Authentication`` or ``Trusted_Connection`` parameters.

.. _azure_synapse_ignore_no_transaction_on_rollback:

Avoiding transaction-related exceptions on Azure Synapse Analytics
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Azure Synapse Analytics has a significant difference in its transaction
handling compared to plain SQL Server; in some cases an error within a Synapse
transaction can cause it to be arbitrarily terminated on the server side, which
then causes the DBAPI ``.rollback()`` method (as well as ``.commit()``) to
fail. The issue prevents the usual DBAPI contract of allowing ``.rollback()``
to pass silently if no transaction is present as the driver does not expect
this condition. The symptom of this failure is an exception with a message
resembling 'No corresponding transaction found. (111214)' when attempting to
emit a ``.rollback()`` after an operation had a failure of some kind.

This specific case can be handled by passing ``ignore_no_transaction_on_rollback=True`` to
the SQL Server dialect via the :func:`_sa.create_engine` function as follows::

    engine = create_engine(connection_url, ignore_no_transaction_on_rollback=True)

Using the above parameter, the dialect will catch ``ProgrammingError``
exceptions raised during ``connection.rollback()`` and emit a warning
if the error message contains code ``111214``, however will not raise
an exception.

.. versionadded:: 1.4.40  Added the
   ``ignore_no_transaction_on_rollback=True`` parameter.

Enable autocommit for Azure SQL Data Warehouse (DW) connections
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Azure SQL Data Warehouse does not support transactions,
and that can cause problems with SQLAlchemy's "autobegin" (and implicit
commit/rollback) behavior. We can avoid these problems by enabling autocommit
at both the pyodbc and engine levels::

    connection_url = sa.engine.URL.create(
        "mssql+pyodbc",
        username="scott",
        password="tiger",
        host="dw.azure.example.com",
        database="mydb",
        query={
            "driver": "ODBC Driver 17 for SQL Server",
            "autocommit": "True",
        },
    )

    engine = create_engine(connection_url).execution_options(
        isolation_level="AUTOCOMMIT"
    )

Avoiding sending large string parameters as TEXT/NTEXT
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

By default, for historical reasons, Microsoft's ODBC drivers for SQL Server
send long string parameters (greater than 4000 SBCS characters or 2000 Unicode
characters) as TEXT/NTEXT values. TEXT and NTEXT have been deprecated for many
years and are starting to cause compatibility issues with newer versions of
SQL_Server/Azure. For example, see `this
issue &lt;https://github.com/mkleehammer/pyodbc/issues/835&gt;`_.

Starting with ODBC Driver 18 for SQL Server we can override the legacy
behavior and pass long strings as varchar(max)/nvarchar(max) using the
``LongAsMax=Yes`` connection string parameter::

    connection_url = sa.engine.URL.create(
        "mssql+pyodbc",
        username="scott",
        password="tiger",
        host="mssqlserver.example.com",
        database="mydb",
        query={
            "driver": "ODBC Driver 18 for SQL Server",
            "LongAsMax": "Yes",
        },
    )


Pyodbc Pooling / connection close behavior
------------------------------------------

PyODBC uses internal `pooling
&lt;https://github.com/mkleehammer/pyodbc/wiki/The-pyodbc-Module#pooling&gt;`_ by
default, which means connections will be longer lived than they are within
SQLAlchemy itself.  As SQLAlchemy has its own pooling behavior, it is often
preferable to disable this behavior.  This behavior can only be disabled
globally at the PyODBC module level, **before** any connections are made::

    import pyodbc

    pyodbc.pooling = False

    # don't use the engine before pooling is set to False
    engine = create_engine("mssql+pyodbc://user:pass@dsn")

If this variable is left at its default value of ``True``, **the application
will continue to maintain active database connections**, even when the
SQLAlchemy engine itself fully discards a connection or if the engine is
disposed.

.. seealso::

    `pooling &lt;https://github.com/mkleehammer/pyodbc/wiki/The-pyodbc-Module#pooling&gt;`_ -
    in the PyODBC documentation.

Driver / Unicode Support
-------------------------

PyODBC works best with Microsoft ODBC drivers, particularly in the area
of Unicode support on both Python 2 and Python 3.

Using the FreeTDS ODBC drivers on Linux or OSX with PyODBC is **not**
recommended; there have been historically many Unicode-related issues
in this area, including before Microsoft offered ODBC drivers for Linux
and OSX.   Now that Microsoft offers drivers for all platforms, for
PyODBC support these are recommended.  FreeTDS remains relevant for
non-ODBC drivers such as pymssql where it works very well.


Rowcount Support
----------------

Pyodbc only has partial support for rowcount.  See the notes at
:ref:`mssql_rowcount_versioning` for important notes when using ORM
versioning.

.. _mssql_pyodbc_fastexecutemany:

Fast Executemany Mode
---------------------

.. note:: SQLAlchemy 2.0 now includes an equivalent "fast executemany"
   handler for INSERT statements that is more robust than the PyODBC feature;
   the feature is called :ref:`insertmanyvalues &lt;engine_insertmanyvalues&gt;`
   and is enabled by default for all INSERT statements used by SQL Server.
   SQLAlchemy's feature integrates with the PyODBC ``setinputsizes()`` method
   which allows for more accurate specification of datatypes, and additionally
   uses a dynamically sized, batched approach that scales to any number of
   columns and/or rows.

   The SQL Server ``fast_executemany`` parameter may be used at the same time
   as ``insertmanyvalues`` is enabled; however, the parameter will not be used
   in as many cases as INSERT statements that are invoked using Core
   :class:`_dml.Insert` constructs as well as all ORM use no longer use the
   ``.executemany()`` DBAPI cursor method.

The PyODBC driver includes support for a "fast executemany" mode of execution
which greatly reduces round trips for a DBAPI ``executemany()`` call when using
Microsoft ODBC drivers, for **limited size batches that fit in memory**.  The
feature is enabled by setting the attribute ``.fast_executemany`` on the DBAPI
cursor when an executemany call is to be used.   The SQLAlchemy PyODBC SQL
Server dialect supports this parameter by passing the
``fast_executemany`` parameter to
:func:`_sa.create_engine` , when using the **Microsoft ODBC driver only**::

    engine = create_engine(
        "mssql+pyodbc://scott:tiger@mssql2017:1433/test?driver=ODBC+Driver+17+for+SQL+Server",
        fast_executemany=True)


.. versionadded:: 1.3

.. seealso::

    `fast executemany &lt;https://github.com/mkleehammer/pyodbc/wiki/Features-beyond-the-DB-API#fast_executemany&gt;`_
    - on github

.. _mssql_pyodbc_setinputsizes:

Setinputsizes Support
-----------------------

As of version 2.0, the pyodbc ``cursor.setinputsizes()`` method is used for
all statement executions, except for ``cursor.executemany()`` calls when
fast_executemany=True where it is not supported (assuming
:ref:`insertmanyvalues &lt;engine_insertmanyvalues&gt;` is kept enabled,
"fastexecutemany" will not take place for INSERT statements in any case).

The behavior of setinputsizes can be customized via the
:meth:`.DialectEvents.do_setinputsizes` hook. See that method for usage
examples.

.. versionchanged:: 1.4.1  The pyodbc dialects will not use setinputsizes
   unless ``use_setinputsizes=True`` is passed.

.. versionchanged:: 2.0  The mssql+pyodbc dialect now defaults to using
   setinputsizes for all statement executions with the exception of
   cursor.executemany() calls when fast_executemany=True.</p></div>
        </div>

        <div id="splitTables">
          <table class="children sortable" id="id145">
  
  
  <tr class="class">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc.MSDialect_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc.MSDialect_pyodbc"><wbr></wbr>MSDialect_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc.MSExecutionContext_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc.MSExecutionContext_pyodbc"><wbr></wbr>MSExecution<wbr></wbr>Context_pyodbc</a></code></td>
    <td><span class="undocumented">No class docstring; 0/2 instance variable, 1/2 method documented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._BINARY_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._BINARY_pyodbc">_<wbr></wbr>BINARY_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._JSON_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._JSON_pyodbc">_<wbr></wbr>JSON_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._JSONIndexType_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._JSONIndexType_pyodbc">_<wbr></wbr>JSONIndex<wbr></wbr>Type_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._JSONPathType_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._JSONPathType_pyodbc">_<wbr></wbr>JSONPath<wbr></wbr>Type_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._ms_binary_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ms_binary_pyodbc">_ms<wbr></wbr>_binary<wbr></wbr>_pyodbc</a></code></td>
    <td>Wraps binary values in dialect-specific Binary wrapper. If the value is null, return a pyodbc-specific BinaryNull object to prevent pyODBC [and FreeTDS] from defaulting binary NULL types to SQLWCHAR and causing implicit conversion errors.</td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._ms_numeric_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ms_numeric_pyodbc">_ms<wbr></wbr>_numeric<wbr></wbr>_pyodbc</a></code></td>
    <td>Turns Decimals with adjusted() &lt; 0 or &gt; 7 into strings.</td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._MSFloat_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._MSFloat_pyodbc">_<wbr></wbr>MSFloat_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._MSNumeric_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._MSNumeric_pyodbc">_<wbr></wbr>MSNumeric_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTime.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTime">_<wbr></wbr>ODBCDate<wbr></wbr>Time</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTimeBindProcessor.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ODBCDateTimeBindProcessor">_<wbr></wbr>ODBCDate<wbr></wbr>Time<wbr></wbr>Bind<wbr></wbr>Processor</a></code></td>
    <td>Add bind processors to handle datetimeoffset behaviors</td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._ODBCDATETIMEOFFSET.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._ODBCDATETIMEOFFSET">_ODBCDATETIMEOFFSET</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._String_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._String_pyodbc">_<wbr></wbr>String_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._Unicode_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._Unicode_pyodbc">_<wbr></wbr>Unicode_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._UnicodeText_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._UnicodeText_pyodbc">_<wbr></wbr>Unicode<wbr></wbr>Text_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="class private">
    
    <td>Class</td>
    <td><code><a href="sqlalchemy.dialects.mssql.pyodbc._VARBINARY_pyodbc.html" class="internal-link" title="sqlalchemy.dialects.mssql.pyodbc._VARBINARY_pyodbc">_<wbr></wbr>VARBINARY_pyodbc</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
          

            
        </div>

        <div id="childList">
          
        </div>
      
      </div>
    </div>

    <footer class="navbar navbar-default">

  
  <div class="container">
    <a href="index.html">API Documentation</a> for sqlalchemy,
  generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a>
    22.9.1.dev0 at 2023-02-10 01:08:41.
  </div>

  <!-- Search related scripts needs to be loaded at the end of HTML 
    parsing not to introduce overhead and display HTML data asap -->
  <script src="ajax.js" type="text/javascript"></script>
  <script src="searchlib.js" type="text/javascript"></script>
  <script src="search.js" type="text/javascript"></script>

</footer>
  
    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>
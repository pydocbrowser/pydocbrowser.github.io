<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "DTD/xhtml1-strict.dtd">
<html>
  

  <head>
    
    <title>sqlalchemy.sql.selectable.HasCTE</title>
    <meta name="generator" content="pydoctor 22.9.1"> 
        
    </meta>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1" />
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="apidocs.css" />
    <link rel="stylesheet" type="text/css" href="extra.css" />
</head>

  <body>

    <div id="banner">    
    <div>
        <a href="/">Home</a>
        &gt; sqlalchemy-1.4.43 <!-- This is a placeholder -->
        
        <!-- (<a href=""&gt;show all versions</a&gt;) -->
    </div>
</div>

    <nav class="navbar navbar-default mainnavbar">
      
  
  <div class="container-fluid">


    <div class="navbar-header">
      
      <div class="navlinks">
        <span class="navbar-brand">
          sqlalchemy <a href="index.html">API Documentation</a>
        </span>

        <a href="moduleIndex.html">
          Modules
        </a>

        <a href="classIndex.html">
          Classes
        </a>

        <a href="nameIndex.html">
          Names
        </a>

        <div id="search-box-container">
          <div class="input-group">
            <input id="search-box" type="search" name="search-query" placeholder="Search..." aria-label="Search" minlength="2" class="form-control" autocomplete="off" />
            
            <span class="input-group-btn">
              <a style="display: none;" class="btn btn-default" id="search-clear-button" title="Clear" onclick="clearSearch()"><img src="fonts/x-circle.svg" alt="Clear" /></a>
              <a class="btn btn-default" id="search-help-button" title="Help" onclick="toggleSearchHelpText()"><img src="fonts/info.svg" alt="Help" /></a>
            </span>
          </div>
        </div>

      </div>

      <div id="search-results-container" style="display: none;">
        
        <div id="search-buttons">
          <span class="label label-default" id="search-docstrings-button">
          <label class="checkbox-inline">
            <input type="checkbox" id="toggle-search-in-docstrings-checkbox" value="false" onclick="toggleSearchInDocstrings()">
              search in docstrings
            </input>
          </label>
          </span>
          
        </div>
        
        <noscript>
            <h1>Cannot search: JavaScript is not supported/enabled in your browser.</h1>
        </noscript>

        <div class="hint" id="search-help-box">
          <p class="rst-last">
      
            Search bar offers the following options:
            <ul>   
                <li>
                  <strong>Term presence.</strong> The below example searches for documents that 
                    must contain “foo”, might contain “bar” and must not contain “baz”: <code>+foo bar -baz</code>
                </li> 

                <li>
                  <strong>Wildcards.</strong> The below example searches for documents with words beginning with “foo”: <code>foo*</code>
                </li> 

                <li>
                  <strong>Search in specific fields.</strong> The following search matches all objects 
                  in "twisted.mail" that matches “search”: <code>+qname:twisted.mail.* +search</code>

                  <p>
                    Possible fields: 'name', 'qname' (fully qualified name), 'docstring', and 'kind'.
                    Last two fields are only applicable if "search in docstrings" is enabled.
                  </p>
                </li>

                <li>
                  <strong>Fuzzy matches.</strong> The following search matches all documents 
                  that have a word within 1 edit distance of “foo”: <code>foo~1</code>
                </li>
            </ul>

          </p>
        </div>

        <div id="search-status"> </div>

        <div class="warning" id="search-warn-box" style="display: none;">
          <p class="rst-last"><span id="search-warn"></span></p>
        </div>

        <table id="search-results">
          <!-- Filled dynamically by JS -->
        </table>
        
        <div style="margin-top: 8px;">
          <p>Results provided by <a href="https://lunrjs.com">Lunr.js</a></p>
        </div>
      </div>

    </div>


  </div>
</nav>
    
    <div class="container-fluid">

      <!-- Side navigation -->
      <div class="sidebarcontainer" style="display: none;">
        
        <div class="sidebar"><nav class="sidebar">
  

  <div>

      <div class="thingTitle">
        <span>Class</span>
        <code class="thisobject"><a href="sqlalchemy.sql.selectable.HasCTE.html" class="internal-link" title="This class"><wbr></wbr>Has<wbr></wbr>CTE</a></code> 
      </div>
      
      <div>
        

        
         

        
        

        <div class="childrenKindTitle">Methods</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="#add_cte" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE.add_cte">add<wbr></wbr>_cte</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="#cte" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE.cte">cte</a></code>
            </div>
        

    </li>
</ul> 

        
         

        <div class="childrenKindTitle">Attributes</div>
        <ul>
    
    <li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_has_ctes_traverse_internals" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE._has_ctes_traverse_internals">_has<wbr></wbr>_ctes<wbr></wbr>_traverse<wbr></wbr>_internals</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="#_independent_ctes" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE._independent_ctes">_independent<wbr></wbr>_ctes</a></code>
            </div>
        

    </li>
</ul> 

        <div class="childrenKindTitle">Inherited Attributes</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.roles.SQLRole.html#allows_lambda" class="internal-link" title="sqlalchemy.sql.roles.SQLRole.allows_lambda">allows<wbr></wbr>_lambda</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.roles.SQLRole.html#uses_inspection" class="internal-link" title="sqlalchemy.sql.roles.SQLRole.uses_inspection">uses<wbr></wbr>_inspection</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.roles.ReturnsRowsRole.html#_role_name" class="internal-link" title="sqlalchemy.sql.roles.ReturnsRowsRole._role_name">_role<wbr></wbr>_name</a></code>
            </div>
        

    </li>
</ul> 
        
      </div>
  </div><div>

      <div class="thingTitle">
        <span>Module</span>
        <code><a href="sqlalchemy.sql.selectable.html" class="internal-link" title="The parent of this class">selectable</a></code> 
      </div>
      
      <div>
        

        
         

        <div class="childrenKindTitle">Classes</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.AnnotatedFromClause.html" class="internal-link" title="sqlalchemy.sql.selectable.AnnotatedFromClause"><wbr></wbr>Annotated<wbr></wbr>From<wbr></wbr>Clause</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.CompoundSelectState.html" class="internal-link" title="sqlalchemy.sql.selectable.CompoundSelectState"><wbr></wbr>Compound<wbr></wbr>Select<wbr></wbr>State</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.CTE.html" class="internal-link" title="sqlalchemy.sql.selectable.CTE">CTE</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.DeprecatedSelectBaseGenerations.html" class="internal-link" title="sqlalchemy.sql.selectable.DeprecatedSelectBaseGenerations"><wbr></wbr>Deprecated<wbr></wbr>Select<wbr></wbr>Base<wbr></wbr>Generations</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.DeprecatedSelectGenerations.html" class="internal-link" title="sqlalchemy.sql.selectable.DeprecatedSelectGenerations"><wbr></wbr>Deprecated<wbr></wbr>Select<wbr></wbr>Generations</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.Exists.html" class="internal-link" title="sqlalchemy.sql.selectable.Exists"><wbr></wbr>Exists</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.ForUpdateArg.html" class="internal-link" title="sqlalchemy.sql.selectable.ForUpdateArg"><wbr></wbr>For<wbr></wbr>Update<wbr></wbr>Arg</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.FromGrouping.html" class="internal-link" title="sqlalchemy.sql.selectable.FromGrouping"><wbr></wbr>From<wbr></wbr>Grouping</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.GenerativeSelect.html" class="internal-link" title="sqlalchemy.sql.selectable.GenerativeSelect"><wbr></wbr>Generative<wbr></wbr>Select</a></code>
            </div>
        

    </li><li class=" thisobject">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.HasCTE.html" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE"><wbr></wbr>Has<wbr></wbr>CTE</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.HasHints.html" class="internal-link" title="sqlalchemy.sql.selectable.HasHints"><wbr></wbr>Has<wbr></wbr>Hints</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.HasPrefixes.html" class="internal-link" title="sqlalchemy.sql.selectable.HasPrefixes"><wbr></wbr>Has<wbr></wbr>Prefixes</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.HasSuffixes.html" class="internal-link" title="sqlalchemy.sql.selectable.HasSuffixes"><wbr></wbr>Has<wbr></wbr>Suffixes</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.NoInit.html" class="internal-link" title="sqlalchemy.sql.selectable.NoInit"><wbr></wbr>No<wbr></wbr>Init</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.ReturnsRows.html" class="internal-link" title="sqlalchemy.sql.selectable.ReturnsRows"><wbr></wbr>Returns<wbr></wbr>Rows</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.ScalarSelect.html" class="internal-link" title="sqlalchemy.sql.selectable.ScalarSelect"><wbr></wbr>Scalar<wbr></wbr>Select</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.SelectBase.html" class="internal-link" title="sqlalchemy.sql.selectable.SelectBase"><wbr></wbr>Select<wbr></wbr>Base</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.SelectState.html" class="internal-link" title="sqlalchemy.sql.selectable.SelectState"><wbr></wbr>Select<wbr></wbr>State</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.SelectStatementGrouping.html" class="internal-link" title="sqlalchemy.sql.selectable.SelectStatementGrouping"><wbr></wbr>Select<wbr></wbr>Statement<wbr></wbr>Grouping</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.TextualSelect.html" class="internal-link" title="sqlalchemy.sql.selectable.TextualSelect"><wbr></wbr>Textual<wbr></wbr>Select</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable._MemoizedSelectEntities.html" class="internal-link" title="sqlalchemy.sql.selectable._MemoizedSelectEntities">_<wbr></wbr>Memoized<wbr></wbr>Select<wbr></wbr>Entities</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable._OffsetLimitParam.html" class="internal-link" title="sqlalchemy.sql.selectable._OffsetLimitParam">_<wbr></wbr>Offset<wbr></wbr>Limit<wbr></wbr>Param</a></code>
            </div>
        

    </li><li class="private">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable._SelectFromElements.html" class="internal-link" title="sqlalchemy.sql.selectable._SelectFromElements">_<wbr></wbr>Select<wbr></wbr>From<wbr></wbr>Elements</a></code>
            </div>
        

    </li>
</ul>

        <div class="childrenKindTitle">Functions</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.html#subquery" class="internal-link" title="sqlalchemy.sql.selectable.subquery">subquery</a></code>
            </div>
        

    </li>
</ul> 

        
         

        <div class="childrenKindTitle">Variables</div>
        <ul>
    
    <li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.html#LABEL_STYLE_DISAMBIGUATE_ONLY" class="internal-link" title="sqlalchemy.sql.selectable.LABEL_STYLE_DISAMBIGUATE_ONLY">LABEL<wbr></wbr>_STYLE<wbr></wbr>_DISAMBIGUATE<wbr></wbr>_ONLY</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.html#LABEL_STYLE_NONE" class="internal-link" title="sqlalchemy.sql.selectable.LABEL_STYLE_NONE">LABEL<wbr></wbr>_STYLE<wbr></wbr>_NONE</a></code>
            </div>
        

    </li><li class="">
        
        
        

        
            <div class="itemName"><code><a href="sqlalchemy.sql.selectable.html#LABEL_STYLE_TABLENAME_PLUS_COL" class="internal-link" title="sqlalchemy.sql.selectable.LABEL_STYLE_TABLENAME_PLUS_COL">LABEL<wbr></wbr>_STYLE<wbr></wbr>_TABLENAME<wbr></wbr>_PLUS<wbr></wbr>_COL</a></code>
            </div>
        

    </li>
</ul> 

        
         
        
      </div>
  </div>

</nav>
        </div>
        <div id="collapseSideBar">
          <a class="btn btn-link" onclick="toggleSideBarCollapse()" title="Toggle Sidebar Collapse">
          </a>
        </div> 
        <script src="sidebartoggle.js" type="text/javascript"></script>
       
      </div>

      <div id="main" class="">
        

        

        <div class="page-header">
          <h1 class="class"><code><code><a href="index.html" class="internal-link">sqlalchemy</a></code><wbr></wbr>.<code><a href="sqlalchemy.sql.html" class="internal-link" title="sqlalchemy.sql">sql</a></code><wbr></wbr>.<code><a href="sqlalchemy.sql.selectable.html" class="internal-link" title="sqlalchemy.sql.selectable">selectable</a></code><wbr></wbr>.<code><a href="sqlalchemy.sql.selectable.HasCTE.html" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE">HasCTE</a></code></code></h1>
          <div id="showPrivate">
            <button class="btn btn-link" onclick="togglePrivate()">Toggle Private API</button>
          </div>
        </div>

        <div class="categoryHeader">
          class documentation
        </div>

        <div class="extrasDocstring">
          <p><code><span class="py-keyword">class</span> <span class="py-defname">HasCTE</span>(<a href="sqlalchemy.sql.roles.HasCTERole.html" class="internal-link" title="sqlalchemy.sql.roles.HasCTERole">roles.HasCTERole</a>): <a href="https://github.com/pydocbrowser/pydocbrowser.github.io/tree/main/build/sources/sqlalchemy-1.4.43//lib/sqlalchemy/sql/selectable.py#L2207" class="sourceLink">(source)</a></code></p><p>Known subclasses: <code><a href="sqlalchemy.sql.dml.UpdateBase.html" class="internal-link">sqlalchemy.sql.dml.UpdateBase</a></code>, <code><a href="sqlalchemy.sql.selectable.SelectBase.html" class="internal-link">sqlalchemy.sql.selectable.SelectBase</a></code></p>
          <p><a href="classIndex.html#sqlalchemy.sql.selectable.HasCTE">View In Hierarchy</a></p>
        </div>

        <div class="moduleDocstring">
          <div><p class="pre">Mixin that declares a class to include CTE support.

.. versionadded:: 1.1</p></div>
        </div>

        <div id="splitTables">
          <table class="children sortable" id="id5941">
  
  
  <tr class="method">
    
    <td>Method</td>
    <td><code><a href="#add_cte" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE.add_cte">add<wbr></wbr>_cte</a></code></td>
    <td>Add a :class:`_sql.CTE` to this statement object that will be independently rendered even if not referenced in the statement otherwise.</td>
  </tr><tr class="method">
    
    <td>Method</td>
    <td><code><a href="#cte" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE.cte">cte</a></code></td>
    <td>Return a new :class:`_expression.CTE`, or Common Table Expression instance.</td>
  </tr><tr class="classvariable private">
    
    <td>Class Variable</td>
    <td><code><a href="#_has_ctes_traverse_internals" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE._has_ctes_traverse_internals">_has<wbr></wbr>_ctes<wbr></wbr>_traverse<wbr></wbr>_internals</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="classvariable private">
    
    <td>Class Variable</td>
    <td><code><a href="#_independent_ctes" class="internal-link" title="sqlalchemy.sql.selectable.HasCTE._independent_ctes">_independent<wbr></wbr>_ctes</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
          
            <p class="inheritedFrom">
              Inherited from <code><a href="sqlalchemy.sql.roles.ReturnsRowsRole.html" class="internal-link" title="sqlalchemy.sql.roles.ReturnsRowsRole">ReturnsRowsRole</a></code> (via <code><a href="sqlalchemy.sql.roles.HasCTERole.html" class="internal-link" title="sqlalchemy.sql.roles.HasCTERole">HasCTERole</a></code>):
            </p>
            <table class="children sortable" id="id5942">
  
  
  <tr class="baseclassvariable private">
    
    <td>Class Variable</td>
    <td><code><a href="sqlalchemy.sql.roles.ReturnsRowsRole.html#_role_name" class="internal-link" title="sqlalchemy.sql.roles.ReturnsRowsRole._role_name">_role<wbr></wbr>_name</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
            
            <p class="inheritedFrom">
              Inherited from <code><a href="sqlalchemy.sql.roles.SQLRole.html" class="internal-link" title="sqlalchemy.sql.roles.SQLRole">SQLRole</a></code> (via <code><a href="sqlalchemy.sql.roles.HasCTERole.html" class="internal-link" title="sqlalchemy.sql.roles.HasCTERole">HasCTERole</a></code>, <code><a href="sqlalchemy.sql.roles.ReturnsRowsRole.html" class="internal-link" title="sqlalchemy.sql.roles.ReturnsRowsRole">ReturnsRowsRole</a></code>):
            </p>
            <table class="children sortable" id="id5943">
  
  
  <tr class="baseclassvariable">
    
    <td>Class Variable</td>
    <td><code><a href="sqlalchemy.sql.roles.SQLRole.html#allows_lambda" class="internal-link" title="sqlalchemy.sql.roles.SQLRole.allows_lambda">allows<wbr></wbr>_lambda</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr><tr class="baseclassvariable">
    
    <td>Class Variable</td>
    <td><code><a href="sqlalchemy.sql.roles.SQLRole.html#uses_inspection" class="internal-link" title="sqlalchemy.sql.roles.SQLRole.uses_inspection">uses<wbr></wbr>_inspection</a></code></td>
    <td><span class="undocumented">Undocumented</span></td>
  </tr>
</table>
            

            
        </div>

        <div id="childList">
          <div class="basemethod">
  
  
  <a name="sqlalchemy.sql.selectable.HasCTE.add_cte">
    
  </a>
  <a name="add_cte">
    
  </a>
  <div class="functionHeader">
    @<a href="sqlalchemy.sql.base.html#_generative" class="internal-link" title="sqlalchemy.sql.base._generative">_generative</a><br />
    <span class="py-keyword">def</span> <span class="py-defname">add_cte</span>(self, cte):
    <a class="sourceLink" href="https://github.com/pydocbrowser/pydocbrowser.github.io/tree/main/build/sources/sqlalchemy-1.4.43//lib/sqlalchemy/sql/selectable.py#L2220">
      
      (source)
    </a>
    <a class="headerLink" href="#add_cte" title="sqlalchemy.sql.selectable.HasCTE.add_cte">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p class="pre">Add a :class:`_sql.CTE` to this statement object that will be
independently rendered even if not referenced in the statement
otherwise.

This feature is useful for the use case of embedding a DML statement
such as an INSERT or UPDATE as a CTE inline with a primary statement
that may draw from its results indirectly; while PostgreSQL is known
to support this usage, it may not be supported by other backends.

E.g.::

    from sqlalchemy import table, column, select
    t = table('t', column('c1'), column('c2'))

    ins = t.insert().values({"c1": "x", "c2": "y"}).cte()

    stmt = select(t).add_cte(ins)

Would render::

    WITH anon_1 AS
    (INSERT INTO t (c1, c2) VALUES (:param_1, :param_2))
    SELECT t.c1, t.c2
    FROM t

Above, the "anon_1" CTE is not referred towards in the SELECT
statement, however still accomplishes the task of running an INSERT
statement.

Similarly in a DML-related context, using the PostgreSQL
:class:`_postgresql.Insert` construct to generate an "upsert"::

    from sqlalchemy import table, column
    from sqlalchemy.dialects.postgresql import insert

    t = table("t", column("c1"), column("c2"))

    delete_statement_cte = (
        t.delete().where(t.c.c1 &lt; 1).cte("deletions")
    )

    insert_stmt = insert(t).values({"c1": 1, "c2": 2})
    update_statement = insert_stmt.on_conflict_do_update(
        index_elements=[t.c.c1],
        set_={
            "c1": insert_stmt.excluded.c1,
            "c2": insert_stmt.excluded.c2,
        },
    ).add_cte(delete_statement_cte)

    print(update_statement)

The above statement renders as::

    WITH deletions AS
    (DELETE FROM t WHERE t.c1 &lt; %(c1_1)s)
    INSERT INTO t (c1, c2) VALUES (%(c1)s, %(c2)s)
    ON CONFLICT (c1) DO UPDATE SET c1 = excluded.c1, c2 = excluded.c2

.. versionadded:: 1.4.21</p></div>
  </div>
</div><div class="basemethod">
  
  
  <a name="sqlalchemy.sql.selectable.HasCTE.cte">
    
  </a>
  <a name="cte">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-keyword">def</span> <span class="py-defname">cte</span>(self, name=<a href="https://docs.python.org/3/library/constants.html#None" class="intersphinx-link">None</a>, recursive=<a href="https://docs.python.org/3/library/constants.html#False" class="intersphinx-link">False</a>, nesting=<a href="https://docs.python.org/3/library/constants.html#False" class="intersphinx-link">False</a>):
    <a class="sourceLink" href="https://github.com/pydocbrowser/pydocbrowser.github.io/tree/main/build/sources/sqlalchemy-1.4.43//lib/sqlalchemy/sql/selectable.py#L2287">
      
      (source)
    </a>
    <a class="headerLink" href="#cte" title="sqlalchemy.sql.selectable.HasCTE.cte">
      
      
      ¶
    </a>
  </div>
  <div class="docstring functionBody">
    
    <div><p class="pre">Return a new :class:`_expression.CTE`,
or Common Table Expression instance.

Common table expressions are a SQL standard whereby SELECT
statements can draw upon secondary statements specified along
with the primary statement, using a clause called "WITH".
Special semantics regarding UNION can also be employed to
allow "recursive" queries, where a SELECT statement can draw
upon the set of rows that have previously been selected.

CTEs can also be applied to DML constructs UPDATE, INSERT
and DELETE on some databases, both as a source of CTE rows
when combined with RETURNING, as well as a consumer of
CTE rows.

.. versionchanged:: 1.1 Added support for UPDATE/INSERT/DELETE as
   CTE, CTEs added to UPDATE/INSERT/DELETE.

SQLAlchemy detects :class:`_expression.CTE` objects, which are treated
similarly to :class:`_expression.Alias` objects, as special elements
to be delivered to the FROM clause of the statement as well
as to a WITH clause at the top of the statement.

For special prefixes such as PostgreSQL "MATERIALIZED" and
"NOT MATERIALIZED", the :meth:`_expression.CTE.prefix_with`
method may be
used to establish these.

.. versionchanged:: 1.3.13 Added support for prefixes.
   In particular - MATERIALIZED and NOT MATERIALIZED.

:param name: name given to the common table expression.  Like
 :meth:`_expression.FromClause.alias`, the name can be left as
 ``None`` in which case an anonymous symbol will be used at query
 compile time.
:param recursive: if ``True``, will render ``WITH RECURSIVE``.
 A recursive common table expression is intended to be used in
 conjunction with UNION ALL in order to derive rows
 from those already selected.
:param nesting: if ``True``, will render the CTE locally to the
 actual statement.

 .. versionadded:: 1.4.24

The following examples include two from PostgreSQL's documentation at
https://www.postgresql.org/docs/current/static/queries-with.html,
as well as additional examples.

Example 1, non recursive::

    from sqlalchemy import (Table, Column, String, Integer,
                            MetaData, select, func)

    metadata = MetaData()

    orders = Table('orders', metadata,
        Column('region', String),
        Column('amount', Integer),
        Column('product', String),
        Column('quantity', Integer)
    )

    regional_sales = select(
                        orders.c.region,
                        func.sum(orders.c.amount).label('total_sales')
                    ).group_by(orders.c.region).cte("regional_sales")


    top_regions = select(regional_sales.c.region).\
            where(
                regional_sales.c.total_sales &gt;
                select(
                    func.sum(regional_sales.c.total_sales) / 10
                )
            ).cte("top_regions")

    statement = select(
                orders.c.region,
                orders.c.product,
                func.sum(orders.c.quantity).label("product_units"),
                func.sum(orders.c.amount).label("product_sales")
        ).where(orders.c.region.in_(
            select(top_regions.c.region)
        )).group_by(orders.c.region, orders.c.product)

    result = conn.execute(statement).fetchall()

Example 2, WITH RECURSIVE::

    from sqlalchemy import (Table, Column, String, Integer,
                            MetaData, select, func)

    metadata = MetaData()

    parts = Table('parts', metadata,
        Column('part', String),
        Column('sub_part', String),
        Column('quantity', Integer),
    )

    included_parts = select(\
        parts.c.sub_part, parts.c.part, parts.c.quantity\
        ).\
        where(parts.c.part=='our part').\
        cte(recursive=True)


    incl_alias = included_parts.alias()
    parts_alias = parts.alias()
    included_parts = included_parts.union_all(
        select(
            parts_alias.c.sub_part,
            parts_alias.c.part,
            parts_alias.c.quantity
        ).\
        where(parts_alias.c.part==incl_alias.c.sub_part)
    )

    statement = select(
                included_parts.c.sub_part,
                func.sum(included_parts.c.quantity).
                  label('total_quantity')
            ).\
            group_by(included_parts.c.sub_part)

    result = conn.execute(statement).fetchall()

Example 3, an upsert using UPDATE and INSERT with CTEs::

    from datetime import date
    from sqlalchemy import (MetaData, Table, Column, Integer,
                            Date, select, literal, and_, exists)

    metadata = MetaData()

    visitors = Table('visitors', metadata,
        Column('product_id', Integer, primary_key=True),
        Column('date', Date, primary_key=True),
        Column('count', Integer),
    )

    # add 5 visitors for the product_id == 1
    product_id = 1
    day = date.today()
    count = 5

    update_cte = (
        visitors.update()
        .where(and_(visitors.c.product_id == product_id,
                    visitors.c.date == day))
        .values(count=visitors.c.count + count)
        .returning(literal(1))
        .cte('update_cte')
    )

    upsert = visitors.insert().from_select(
        [visitors.c.product_id, visitors.c.date, visitors.c.count],
        select(literal(product_id), literal(day), literal(count))
            .where(~exists(update_cte.select()))
    )

    connection.execute(upsert)

Example 4, Nesting CTE (SQLAlchemy 1.4.24 and above)::

    value_a = select(
        literal("root").label("n")
    ).cte("value_a")

    # A nested CTE with the same name as the root one
    value_a_nested = select(
        literal("nesting").label("n")
    ).cte("value_a", nesting=True)

    # Nesting CTEs takes ascendency locally
    # over the CTEs at a higher level
    value_b = select(value_a_nested.c.n).cte("value_b")

    value_ab = select(value_a.c.n.label("a"), value_b.c.n.label("b"))

The above query will render the second CTE nested inside the first,
shown with inline parameters below as::

    WITH
        value_a AS
            (SELECT 'root' AS n),
        value_b AS
            (WITH value_a AS
                (SELECT 'nesting' AS n)
            SELECT value_a.n AS n FROM value_a)
    SELECT value_a.n AS a, value_b.n AS b
    FROM value_a, value_b

Example 5, Non-Linear CTE (SQLAlchemy 1.4.28 and above)::

    edge = Table(
        "edge",
        metadata,
        Column("id", Integer, primary_key=True),
        Column("left", Integer),
        Column("right", Integer),
    )

    root_node = select(literal(1).label("node")).cte(
        "nodes", recursive=True
    )

    left_edge = select(edge.c.left).join(
        root_node, edge.c.right == root_node.c.node
    )
    right_edge = select(edge.c.right).join(
        root_node, edge.c.left == root_node.c.node
    )

    subgraph_cte = root_node.union(left_edge, right_edge)

    subgraph = select(subgraph_cte)

The above query will render 2 UNIONs inside the recursive CTE::

    WITH RECURSIVE nodes(node) AS (
            SELECT 1 AS node
        UNION
            SELECT edge."left" AS "left"
            FROM edge JOIN nodes ON edge."right" = nodes.node
        UNION
            SELECT edge."right" AS "right"
            FROM edge JOIN nodes ON edge."left" = nodes.node
    )
    SELECT nodes.node FROM nodes

.. seealso::

    :meth:`_orm.Query.cte` - ORM version of
    :meth:`_expression.HasCTE.cte`.</p></div>
  </div>
</div><div class="baseclassvariable private">
  
  
  <a name="sqlalchemy.sql.selectable.HasCTE._has_ctes_traverse_internals">
    
  </a>
  <a name="_has_ctes_traverse_internals">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-defname">_has_ctes_traverse_internals</span> =
    <a class="sourceLink" href="https://github.com/pydocbrowser/pydocbrowser.github.io/tree/main/build/sources/sqlalchemy-1.4.43//lib/sqlalchemy/sql/selectable.py#L2214">
      
      (source)
    </a>
    <a class="headerLink" href="#_has_ctes_traverse_internals" title="sqlalchemy.sql.selectable.HasCTE._has_ctes_traverse_internals">
      
      
      ¶
    </a>
  </div>
  <div class="functionBody">
    
    <div><p class="undocumented">Undocumented</p></div>
    
  </div>
</div><div class="baseclassvariable private">
  
  
  <a name="sqlalchemy.sql.selectable.HasCTE._independent_ctes">
    
  </a>
  <a name="_independent_ctes">
    
  </a>
  <div class="functionHeader">
    
    <span class="py-defname">_independent_ctes</span>: <code><a href="https://docs.python.org/3/library/stdtypes.html#tuple" class="intersphinx-link">tuple</a></code> =
    <a class="sourceLink" href="https://github.com/pydocbrowser/pydocbrowser.github.io/tree/main/build/sources/sqlalchemy-1.4.43//lib/sqlalchemy/sql/selectable.py#L2218">
      
      (source)
    </a>
    <a class="headerLink" href="#_independent_ctes" title="sqlalchemy.sql.selectable.HasCTE._independent_ctes">
      
      
      ¶
    </a>
  </div>
  <div class="functionBody">
    
    <div><p class="undocumented">Undocumented</p></div>
    
  </div>
</div>
        </div>
      
      </div>
    </div>

    <footer class="navbar navbar-default">

  
  <div class="container">
    <a href="index.html">API Documentation</a> for sqlalchemy,
  generated by <a href="https://github.com/twisted/pydoctor/">pydoctor</a>
    22.9.1 at 2022-11-05 01:17:46.
  </div>

  <!-- Search related scripts needs to be loaded at the end of HTML 
    parsing not to introduce overhead and display HTML data asap -->
  <script src="ajax.js" type="text/javascript"></script>
  <script src="searchlib.js" type="text/javascript"></script>
  <script src="search.js" type="text/javascript"></script>

</footer>
  
    <script src="pydoctor.js" type="text/javascript"></script>

  </body>
</html>